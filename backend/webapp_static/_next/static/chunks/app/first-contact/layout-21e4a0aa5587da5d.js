(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[745],{49753:function(e,t,n){Promise.resolve().then(n.bind(n,54235))},54235:function(e,t,n){"use strict";let r;n.r(t),n.d(t,{Providers:function(){return S}});var o=n(57437),s=n(2265),i=n(36826);function c(e,t){window.dispatchEvent(new StorageEvent("storage",{key:e,newValue:t}))}let l=(e,t)=>{let n=JSON.stringify(t);window.localStorage.setItem(e,n),c(e,n)},a=e=>{window.localStorage.removeItem(e),c(e,null)},u=e=>window.localStorage.getItem(e),h=e=>(window.addEventListener("storage",e),()=>window.removeEventListener("storage",e)),d=()=>{throw Error("useLocalStorage is a client-only hook")};var g={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let v=new Uint8Array(16),f=[];for(let e=0;e<256;++e)f.push((e+256).toString(16).slice(1));var w=function(e,t,n){if(g.randomUUID&&!t&&!e)return g.randomUUID();let o=(e=e||{}).random||(e.rng||function(){if(!r&&!(r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return r(v)})();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t){n=n||0;for(let e=0;e<16;++e)t[n+e]=o[e];return t}return function(e,t=0){return f[e[t+0]]+f[e[t+1]]+f[e[t+2]]+f[e[t+3]]+"-"+f[e[t+4]]+f[e[t+5]]+"-"+f[e[t+6]]+f[e[t+7]]+"-"+f[e[t+8]]+f[e[t+9]]+"-"+f[e[t+10]]+f[e[t+11]]+f[e[t+12]]+f[e[t+13]]+f[e[t+14]]+f[e[t+15]]}(o)};let E=e=>{let{children:t}=e,n=(0,s.useContext)(i.hg),[r,c]=function(e,t){let n=s.useSyncExternalStore(h,()=>u(e),d),r=s.useCallback(t=>{try{let r="function"==typeof t?t(JSON.parse(n)):t;null==r?a(e):l(e,r)}catch(e){console.warn(e)}},[e,n]);return s.useEffect(()=>{null===u(e)&&void 0!==t&&l(e,t)},[e,t]),[n?JSON.parse(n):t,r]}("_SESSION_ID",null);return(0,s.useEffect)(()=>{null===r&&c(w())},[]),(0,s.useEffect)(()=>(null==n||n.registerEvent("_REQUEST_SESSION_ID",()=>{n.send("_SESSION_ID",r)}),null==n||n.registerEvent("_REGEN_SESSION_ID",()=>{c(w()),n.send("_SESSION_ID",r)}),()=>{null==n||n.deregisterEvent("_REQUEST_SESSION_ID"),null==n||n.deregisterEvent("_REGEN_SESSION_ID")}),[n]),(0,o.jsx)(o.Fragment,{children:t})};function S(e){let{children:t}=e,[n,r]=(0,s.useState)(!1);return(0,s.useEffect)(()=>{r(!0)},[]),(0,o.jsxs)(o.Fragment,{children:[n&&(0,o.jsx)(i.U,{url:"ws://".concat(window.location.hostname,":42069/ws/first_contact"),children:(0,o.jsx)(E,{children:t})}),!n&&t]})}},36826:function(e,t,n){"use strict";n.d(t,{U:function(){return c},hg:function(){return i}});var r=n(57437),o=n(2265),s=n(71424);let i=(0,o.createContext)(null),c=e=>{let{url:t,children:n}=e,s=(0,o.useMemo)(()=>new l(t),[t]);return(0,o.useEffect)(()=>()=>{s.disconnect()},[t,s]),(0,r.jsx)(i.Provider,{value:s,children:n})};class l{registerEvent(e,t){if(e in this.eventHandlers)throw Error("already subscribed to ".concat(e));this.eventHandlers[e]=t}deregisterEvent(e){if(!(e in this.eventHandlers))throw Error("not subscribed to ".concat(e));delete this.eventHandlers[e]}registerInit(e,t){if(e in this.initHandlers)throw Error("already registered");this.initHandlers[e]=t}deregisterInit(e){if(!(e in this.initHandlers))throw Error("not registered");delete this.initHandlers[e]}send(e,t){this.isConnected&&this.ws.send(JSON.stringify({type:e,data:t}))}connect(){return console.log("connecting to ",this.url),s.toast.info("Connecting to server..."),this.ws=new WebSocket(this.url),this.autoReconnect=!0,this.ws.onopen=()=>{console.log("connected"),s.toast.success("Connected to server!"),this.isConnected=!0,this.onConnectionChange&&this.onConnectionChange(this.isConnected),this.retryInterval=this.minRetryInterval},this.ws.onclose=()=>{console.log("disconnected"),this.isConnected=!1,this.onConnectionChange&&this.onConnectionChange(this.isConnected),this.autoReconnect?(s.toast.warning("Disconnected from server: Retrying in ".concat(this.retryInterval/1e3," seconds...")),this.retryTimeout=setTimeout(()=>{this!==null&&this.url&&!this.isConnected&&(console.log("reconnecting"),this.connect())},this.retryInterval),this.retryInterval=Math.min(2*this.retryInterval,this.maxRetryInterval)):s.toast.warning("Disconnected from server!")},this.ws.onerror=e=>{console.error("Socket encountered error: ",e,"Closing socket"),s.toast.error("Socket Error: ".concat(e)),this.ws.close()},this.ws.onmessage=e=>{this.handleReceiveEvent(e)},()=>{this.disconnect()}}disconnect(){var e;this.autoReconnect=!1,null===(e=this.ws)||void 0===e||e.close(),this.onConnectionChange&&this.onConnectionChange(!1),null!==this.ws&&(this.ws.onopen=null,this.ws.onclose=null,this.ws.onmessage=null,this.ws.onerror=null,this.ws=null),null!==this.retryTimeout&&(clearTimeout(this.retryTimeout),this.retryTimeout=null)}handleReceiveEvent(e){let t=JSON.parse(e.data);t.type in this.eventHandlers?this.eventHandlers[t.type](t.data):console.log("unhandled event: ".concat(t.type))}constructor(e,t=250,n=1e4){this.ws=null,this.isConnected=!1,this.onConnectionChange=void 0,this.eventHandlers={},this.initHandlers={},this.retryTimeout=null,this.autoReconnect=!0,this.url=e,this.minRetryInterval=t,this.maxRetryInterval=n,this.retryInterval=t}}}},function(e){e.O(0,[409,971,938,744],function(){return e(e.s=49753)}),_N_E=e.O()}]);